Задача
=
Даны 2 окружности. Известны их **радиусы** и **координаты их центров**.

Найти
=
Площадь пересечения окружностей

Решение
=

Решим более простую задачу. Найдем точки пересечения окружностей [`Источник`](http://algolist.manual.ru/maths/geom/intersect/circlecircle2d.php).

Есть две окружности с центрами в точках **A и B**. Их координаты известны. Также известны радиусы окружностей. Нужно найти координаты точек **C и D**.

Допустим окружности пересекаются.
<p align="center">
  <img src="https://github.com/viCodexm/competitive-programming/blob/main/Вычислительная%20геометрия/Пересечение%20двух%20окружностей/Картинки/Картинкадвеокр.png" width="860"/>
</p>

1. Найдем координаты точки **H** (центр хорды **CD**, соединяющей точки пересечения окружностей).
Рассмотрим треугольники **AСH и BСH**. Обозначим расстояние между центрами окружностей за **d**, сторону **AH за a, BH за b, CH за h**. 

Расстояние между центрами окружностей рассчитывается по теореме Пифагора:
$${\Huge d = \sqrt{ {({x}_B-{x}_A)}^{2} + {({y}_B-{y}_A)}^{2}}}$$

Найдем длину стороны **a**, решив систему уравнений:

$${\Huge \\begin{cases} 
    {r}^{2}_a - {a}^{2} = {h}^{2}\\       
    {r}^{2}_b - {b}^{2} = {h}^{2}\\  
    d = a + b
  \end{cases}}$$

,где $\Huge r_a$ - радиус окружности **A**, $\Huge r_b$ - радиус окружности **B**.

Подставим вместо $\Huge {h}^{2}$ в первом уравнении второе уравнение и выразим значение **b** из третьего уравнения: 

$${\Huge \\begin{cases} 
    {r}^{2}_a - {a}^{2} = {r}^{2}_b - {b}^{2}\\       
     b = d - a  
  \end{cases}}$$

Выразим **а**. Упростив систему уравнений, получим:

$${\Huge a=\frac{{r}^{2}_a-{r}^{2}_b+{d}^{2}}{2d} }$$

Теперь рассчитаем координаты точки **H**.

$${\Huge {x}_H={x}_A+\frac{a*({x}_B-{x}_A)}{d} }$$

$${\Huge {y}_H={y}_A+\frac{a*({y}_B-{y}_A)}{d} }$$

Почему именно эти формулы? Все очень просто!

<p align="center">
  <img src="https://github.com/viCodexm/competitive-programming/blob/main/Вычислительная%20геометрия/Пересечение%20двух%20окружностей/Картинки/КордыТочкиH.png" width="500"/>
</p>

Рассмотрим треугольник **ABG**. При вычитании абсциссы(x) центра окружности **A** из абсциссы центра окружности **B**, мы получили длину стороны **AG**. Затем мы ее поделили на расстояние между центрами окружностей **(d)** и получили $\Huge \cos(γ)$ (косинус это отношение прилежащего катета к гипотенузе). Рассмотрим треугольник **AHHx**.  $\Huge \cos(γ)$ мы только что нашли. Далее мы умножаем $\Huge \cos(γ)$ на сторону **a**, **a** сокращаются, и мы получаем длину проекции на сторону **AG**, т.е. длину **AHx** (Косинус однозначно определяет угол. При умножении его на **а** мы как бы сократили знаменатель и остался только числитель, который как раз и является искомой длиной **AHx**). Прибавляем эту длину к абсциссе центра окружности **A** и получаем абсциссу координаты точки **H**.

Для ординаты(y) аналогично.
Вычитаем ординату центра окружности **A** из ординаты **B**, получаем длину **BG**. Делим **BG на d** и получаем $\Huge \sin(γ)$ (синус это отношение противолежащего катета к гипотенузе). Умножаем $\Huge \sin(γ)$ на длину **а** и получаем длину проекции **AH на BG**, т.е. длину стороны **GHy**. Осталось прибавить ее к ординате центра окружности **A**.

[Здесь можно посмотреть как меняются проекции на стороны](https://www.desmos.com/calculator/05tplkytua)

2. Найдем координаты точек С и D по следующим формулам:

$${\Huge h = \sqrt{ {r}^{2}_a - {a}^{2}}}$$

$${\Huge {x}_C={x}_H-\frac{h*({y}_B-{y}_A)}{d} }$$

$${\Huge {y}_C={y}_H+\frac{h*({x}_B-{x}_A)}{d} }$$


$${\Huge {x}_D={x}_H+\frac{h*({y}_B-{y}_A)}{d} }$$

$${\Huge {y}_D={y}_H-\frac{h*({x}_B-{x}_A)}{d} }$$

Объясним формулы:
<p align="center">
  <img src="https://github.com/viCodexm/competitive-programming/blob/main/Вычислительная%20геометрия/Пересечение%20двух%20окружностей/Картинки/КордыТочекCH.png" width="800"/>
</p>

**(!!!В скобках косинусов указывается название угла, а не значение аргумента)**.

Ординаты(y) точек

Рассмотрим треугольник **ABG**. При вычитании абсциссы(x) центра окружности **A** из абсциссы центра окружности **B**, мы получили длину стороны **AG**. Затем мы ее поделили на расстояние между центрами окружностей **(d)** и получили $\Huge \cos(1)$. Взглянем на треугольник **AHK**. $\Huge \cos(1) = \sin(2)$, поскольку прилежащий катет **AK** к углу **1** является противолежащим для угла **2**. Взглянем на треугольник **NHM**. $\Huge \sin(2) = \cos(3)$,  поскольку противолежащий катет **NM** к углу **2** является прилежащим для угла **3**. Посмотрим на треугольник **NHD**. Угол **H** - прямой. $\Huge \cos(3) = \sin(4)$,  поскольку прилежащий катет **NH** к углу **3** является противолежащим для угла **4**. И последнее. Посмотрим на треугольник **HMD**. Мы узнали $\Huge \sin(4)$. $\Huge \sin(4)$ есть отношение стороны **HM к h**. Значит, чтобы получить **HM**, нужно $\Huge \sin(4)$ * **h**, при этом **h** сократятся, и мы получим длину **HM**. Вычитаем ее из ординаты(y) точки **H** и получаем ординату точки **D**, а если мы прибавим длину **HM** к ординате точки **H**, то получим ординату точки **C**.

Абсциссы(x) точек

С абсциссами рассуждение аналогично как с ординатами. Проведя вышеизложенные действия, взяв синус вместо косинуса, мы узнаем $\Huge \cos(4)$. $\Huge \cos(4)$ есть отношение стороны **MD к h**. Значит, чтобы получить **MD**, нужно $\Huge \cos(4)$ * **h**, при этом **h** сократятся и мы получим длину **MD**. Вычитаем ее из абсциссы(x) точки **H** и получаем абсциссу точки **C**, а если мы прибавим длину **MD** к абсциссе точки **H**, то получим абсциссу точки **D**.

А теперь пересечение окружностей
=
<p align="center">
  <img src="https://github.com/viCodexm/competitive-programming/blob/main/Вычислительная%20геометрия/Пересечение%20двух%20окружностей/Картинки/Картинкадвеокр.png" width="700"/>
</p>

Общая идея такова. Нам нужно узнать площадь красной и синей областей. Для этого мы должны вычесть из площади секторов площади треугольников и сложить результаты (из площади сектора **ACD** вычитаем площадь треугольника **ACD** и из площади сектора **BCD** вычитаем площадь треугольника **BCD**).

Площади треугольников найти просто. Мы умножаем длину стороны **h** на сторону **a** для треугольника **ACD** и на сторону **b** для треугольника **BCD** (на самом деле, на примере треугольника **ACD**, мы получаем площадь квадрата со сторонами **a** и **h**, но т.к. квадрат состоит из двух одинаковых треугольников, и треугольник **ACH** = треугольнику **ADH**, мы получили площадь треугольника **ACD**). 

Для треугольника **BCD** рассуждения аналогичны.

Осталось найти площадь сектора, которая получается по такой формуле:

${\Huge {S}_{сек}= \frac{{r}^{2} * α}{2}}$ ,где α - внутренний угол сектора в радианах.

Радиус нам известен, осталось найти угол. Рассмотрим поиск угла для сектора ACD. Мы знаем длину сторон $\Huge r_a$ и **a**. Поделим $\Huge r_a$ на **a** и получим $\Huge \cos(\frac{a}{2})$. Соответсвенно, чтобы найти сам угол **α**, мы должны применить обратную функцию и умножить на 2, т.е. взять $\Huge \arccos(\cos(\frac{a}{2})) * 2$.

Поиск угла для сектора **BCD** аналогичен вышесказанному.


Итого получаем такую формулу по рассчету площади пересечения:

$${\Huge S = ({r}^{2}_a * \arccos{\frac{a}{r_a}} - a * \sqrt{ {r}^{2}_a - {a}^{2}}) + 
({r}^{2}_b * \arccos{\frac{b}{r_b}} - b * \sqrt{ {r}^{2}_b - {b}^{2}})}$$

или 

$${\Huge S = ({r}^{2}_a * \arccos{\frac{a}{r_a}} - a * h) + 
({r}^{2}_b * \arccos{\frac{b}{r_b}} - b * h)}$$

[`Подробная визуализация`](https://www.desmos.com/calculator/e3qbfnzhje)
=
